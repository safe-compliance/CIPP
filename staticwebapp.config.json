{
  "routes": [
    // 1) Cache para assets estáticos
    {
      "route": "_next/static/*",
      "headers": {
        "cache-control": "must-revalidate, max-age=15770000"
      }
    },
    {
      "route": "*.{png,jpg,gif,xml,ico,css,js}",
      "headers": {
        "cache-control": "must-revalidate, max-age=15770000"
      }
    },
    {
      "route": "/assets/*",
      "headers": {
        "cache-control": "must-revalidate, max-age=15770000"
      }
    },

    // 2) Front-end público
    {
      "route": "/",
      "rewrite": "/index.html",
      "allowedRoles": ["anonymous"]
    },
    {
      "route": "/index.html",
      "allowedRoles": ["anonymous"]
    },
    {
      "route": "/404",
      "rewrite": "/404",
      "allowedRoles": ["anonymous"]
    },

    // 3) Entrar / Sair
    {
      "route": "/login",
      "rewrite": "/.auth/login/aad"
    },
    {
      "route": "/logout",
      "redirect": "/.auth/logout?post_logout_redirect_uri=/logout-succeeded",
      "statusCode": 302
    },
    {
      "route": "/logout-succeeded",
      "allowedRoles": ["anonymous"]
    },

    // 4) Callbacks AAD (fluxo clássico e MSAL.js)
    {
      "route": "/auth/microsoft-callback",
      "rewrite": "/.auth/login/aad?post_login_redirect_uri=/auth/microsoft-callback"
    },
    {
      "route": "/auth/msal-callback",
      "rewrite": "/.auth/login/aad?post_login_redirect_uri=/auth/msal-callback"
    },

    // 5) API pública
    {
      "route": "/api/Public*",
      "allowedRoles": ["anonymous"]
    },

    // 6) API protegida
    {
      "route": "/api/*",
      "allowedRoles": ["authenticated"]
    },

    // 7) SPA fallback (tudo o resto)
    {
      "route": "/*",
      "rewrite": "/index.html",
      "allowedRoles": ["anonymous"]
    }
  ],

  // Fallback de navegação para SPA
  "navigationFallback": {
    "rewrite": "/index.html",
    "exclude": [
      "_next/static/*",
      "/css/*",
      "public/*",
      "assets/*",
      "favicon.ico",
      "robots.txt",
      "sitemap.xml",
      "manifest.json"
    ]
  },

  // Redireciona pra login em caso de 401
  "responseOverrides": {
    "401": {
      "redirect": "/.auth/login/aad?post_login_redirect_uri=.referrer",
      "statusCode": 302,
      "exclude": [
        "_next/static/*",
        "/assets/*",
        "/css/*"
      ]
    },
    "403": {
      "rewrite": "/404"
    }
  },

  // CSP e MIME
  "globalHeaders": {
    "content-security-policy": "default-src https: blob: 'unsafe-eval' 'unsafe-inline'; object-src 'self' blob:; img-src 'self' blob: data: *"
  },
  "mimeTypes": {
    ".json": "text/json"
  },

  // 8) Conexão com Azure AD
  "auth": {
    "identityProviders": {
      "azureActiveDirectory": {
        "registration": {
          "openIdIssuer": "https://login.microsoftonline.com/ca23f150-3f58-49f6-b8d6-45b57e193208/v2.0",
          "clientId": "5e4a2a52-475b-4dd3-9436-e682b6acc603"
        }
      }
    }
  }
}
